<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Testes de Overlays (OBS)</title>
  <style>
    :root{
      --bg:#0b0f1a;
      --stroke: rgba(255,255,255,0.12);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.68);
      --good:#22c55e;
      --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 600px at 20% 10%, rgba(96,165,250,0.25), transparent),
                  radial-gradient(900px 500px at 90% 30%, rgba(245,158,11,0.18), transparent),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 28px;
    }

    header{
      max-width: 1320px;
      margin: 0 auto 18px;
      display:flex;
      gap: 16px;
      align-items: flex-end;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    h1{ margin:0; font-size: 28px; letter-spacing: 0.2px; }
    .sub{ margin-top:6px; color: var(--muted); font-size: 14px; max-width: 920px; line-height:1.35; }

    .pill{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,0.22);
      padding: 10px 12px;
      border-radius: 999px;
      display:flex;
      gap:10px;
      align-items:center;
      max-width: 100%;
    }
    .pill label{ font-size: 12px; color: var(--muted); }
    .pill input{
      width: 420px;
      max-width: 60vw;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text);
      font-size: 13px;
    }

    .wrap{
      max-width: 1320px;
      margin: 0 auto;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 1100px){
      .wrap{ grid-template-columns: 1fr; }
    }

    .card{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(0,0,0,0.12));
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 22px 70px rgba(0,0,0,0.35);
      display:flex;
      flex-direction:column;
      gap: 12px;
      overflow:hidden;
    }

    .toprow{
      display:flex;
      gap: 12px;
      align-items:flex-start;
      justify-content: space-between;
    }

    .meta h2{ margin: 0 0 6px; font-size: 18px; }
    .meta .desc{ margin: 0 0 10px; font-size: 13px; color: var(--muted); line-height: 1.35; }

    .tags{ display:flex; gap: 8px; flex-wrap: wrap; }
    .tag{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,0.18);
      color: var(--muted);
    }

    .tools{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      justify-content:flex-end;
    }

    .sizepill{
      display:flex;
      gap:8px;
      align-items:center;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,0.18);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
    }
    .sizepill select{
      border:none;
      outline:none;
      background: transparent;
      color: var(--text);
      font-size: 12px;
    }

    button{
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,0.22);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 800;
      letter-spacing: 0.2px;
    }
    button.small{ padding: 9px 11px; border-radius: 12px; font-size: 12px; }
    button.primary{ border-color: rgba(96,165,250,0.45); background: rgba(96,165,250,0.16); }
    button.good{ border-color: rgba(34,197,94,0.45); background: rgba(34,197,94,0.14); }
    button.warn{ border-color: rgba(245,158,11,0.55); background: rgba(245,158,11,0.14); }
    button.ghost{ background: rgba(0,0,0,0.16); }

    .form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 560px){
      .form{ grid-template-columns: 1fr; }
    }

    .field{
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,0.18);
      border-radius: 14px;
      padding: 10px 12px;
      min-width:0;
    }
    .field label{ display:block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    .field input, .field select{
      width:100%;
      border:none;
      outline:none;
      background: transparent;
      color: var(--text);
      font-size: 14px;
    }

    .sectionTitle{
      margin: 2px 0 -2px;
      font-size: 12px;
      color: rgba(255,255,255,0.78);
      letter-spacing: .22px;
      font-weight: 900;
      text-transform: uppercase;
    }

    .colorGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 2px;
    }
    @media (max-width: 560px){
      .colorGrid{ grid-template-columns: 1fr; }
    }

    .colorRow{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .swatch{
      width: 34px;
      height: 34px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.2);
      overflow:hidden;
      flex: 0 0 auto;
    }
    input[type="color"]{
      width: 44px;
      height: 34px;
      padding:0;
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 10px;
      background: transparent;
    }

    .out{
      border: 1px dashed rgba(255,255,255,0.20);
      background: rgba(0,0,0,0.18);
      border-radius: 14px;
      padding: 12px;
    }
    .out .label{ font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    .out .url{ font-size: 13px; word-break: break-all; line-height: 1.35; }

    .preview{
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.22);
      border-radius: 16px;
      overflow:hidden;
      box-shadow: 0 18px 60px rgba(0,0,0,0.28);
    }
    .preview .bar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      color: var(--muted);
      font-size: 12px;
      gap: 10px;
    }
    .preview .bar .left{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .preview .bar .right{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }

    .stageWrap{
      width: 100%;
      aspect-ratio: 16/6;
      background: #000;
      position: relative;
    }
    .stageWrap.r169{ aspect-ratio: 16/9; }

    .stage{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      border:0;
      background: transparent;
    }

    .hint{ font-size: 12px; color: var(--muted); line-height: 1.35; }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.65);
      border: 1px solid rgba(255,255,255,0.18);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      opacity: 0;
      pointer-events:none;
      transition: opacity 220ms ease;
      font-size: 13px;
      z-index: 50;
    }
    .toast.show{ opacity: 1; }
  </style>
</head>
<body>

<header>
  <div>
    <h1>Página de Testes de Overlays (OBS)</h1>
    <div class="sub">
      Escolhe uma animação, preenche os campos e copia o link final.
      O “Domain” é o servidor do Social Stream Ninja/wordcloud (ex: localhost:3900).
      Usa “Reset wordcloud” para limpar votos/entradas.
    </div>
  </div>

  <div class="pill">
    <label for="domain">Domain</label>
    <input id="domain" type="text" value="http://localhost:3900" />
  </div>
</header>

<div class="wrap" id="list"></div>

<div class="toast" id="toast">Copiado ✅</div>

<script>
  // =========================
  // Página de Testes (OBS)
  // =========================

  const ANIMS = [
    // -------------------------
    // VOTAÇÕES
    // -------------------------
    {
      id: 'votacao_ao_vivo_sim_nao_donut',
      name: 'Votação ao Vivo (Sim / Não) — donut',
      desc: 'Donut (1 roda, 2 opções). Params: yes/no (+ opcional title). Lê via wordcloud.',
      baseUrl: 'https://votacao-ao-vivo.vercel.app/',
      tags: ['Sim/Não', 'donut', 'wordcloud'],
      params: [
        { key: 'title', label: 'Título (opcional)', type: 'text', def: '' },
        { key: 'yes', label: 'Texto Sim', type: 'text', def: 'Sim' },
        { key: 'no', label: 'Texto Não', type: 'text', def: 'Não' },
        { key: 'yesWords', label: 'Sinónimos Sim (csv opcional)', type: 'text', def: '' },
        { key: 'noWords', label: 'Sinónimos Não (csv opcional)', type: 'text', def: '' },
      ],
      colorParams: [
        { key: 'accent', label: 'Accent', def: '#60a5fa' },
        { key: 'text', label: 'Texto', def: '#ffffff' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        if (vals.title) q.set('title', vals.title);
        q.set('yes', vals.yes);
        q.set('no', vals.no);
        if (vals.yesWords) q.set('yesWords', vals.yesWords);
        if (vals.noWords) q.set('noWords', vals.noWords);
        q.set('domain', domain);
        return q;
      },
      resetWords: (vals) => `${vals.yes},${vals.no}`
    },

    {
      id: 'votacao_circular_transparente_nova',
      name: 'Votação Circular (nova) — transparente (Sim/Não)',
      desc: 'Só o donut + contagens (sem fundo). Substitui baseUrl quando estiver publicada.',
      baseUrl: 'https://TODO-SEU-URL.vercel.app/',
      tags: ['Sim/Não', 'donut', 'transparente', 'wordcloud'],
      params: [
        { key: 'yes', label: 'Texto Sim', type: 'text', def: 'Sim' },
        { key: 'no', label: 'Texto Não', type: 'text', def: 'Não' },
        { key: 'yesWords', label: 'Sinónimos Sim (csv opcional)', type: 'text', def: '' },
        { key: 'noWords', label: 'Sinónimos Não (csv opcional)', type: 'text', def: '' },
      ],
      colorParams: [
        { key: 'accent', label: 'Cor Sim (accent)', def: '#22c55e' },
        { key: 'noColor', label: 'Cor Não', def: '#ef4444' },
        { key: 'track', label: 'Track', def: '#ffffff' },
        { key: 'text', label: 'Texto', def: '#ffffff' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('yes', vals.yes);
        q.set('no', vals.no);
        if (vals.yesWords) q.set('yesWords', vals.yesWords);
        if (vals.noWords) q.set('noWords', vals.noWords);
        q.set('domain', domain);
        return q;
      },
      resetWords: () => `Sim,Não,A,B`
    },

    {
      id: 'votacoes_poll4_abcd',
      name: 'Votações (A/B/C/D) — contadores + barras (vertical)',
      desc: 'Poll 4 opções (A/B/C/D). Params: title,a,b,c,d. Lê via wordcloud (A,B,C,D).',
      baseUrl: 'https://votacoes.vercel.app/',
      tags: ['A/B/C/D', 'barras', 'wordcloud'],
      params: [
        { key: 'title', label: 'Título', type: 'text', def: 'Qual escolhes?' },
        { key: 'a', label: 'Opção A', type: 'text', def: 'Opção A' },
        { key: 'b', label: 'Opção B', type: 'text', def: 'Opção B' },
        { key: 'c', label: 'Opção C', type: 'text', def: 'Opção C' },
        { key: 'd', label: 'Opção D', type: 'text', def: 'Opção D' },
        { key: 'leader', label: 'Modo líder (1/0)', type: 'select', def: '1', options: ['1','0'] },
      ],
      colorParams: [
        { key: 'accent', label: 'Accent', def: '#60a5fa' },
        { key: 'track', label: 'Track', def: '#1b2335' },
        { key: 'text', label: 'Texto', def: '#ffffff' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('title', vals.title);
        q.set('a', vals.a);
        q.set('b', vals.b);
        q.set('c', vals.c);
        q.set('d', vals.d);
        if (vals.leader) q.set('leader', vals.leader);
        q.set('domain', domain);
        return q;
      },
      resetWords: () => `A,B,C,D`
    },

    // -------------------------
    // QUIZZES
    // -------------------------
    {
      id: 'quizz_relampago_2op',
      name: 'Quizz Relâmpago (2 opções)',
      desc: 'Pergunta + 2 respostas. Aceita votos A/B (ou keyA/keyB). Lê via wordcloud.',
      baseUrl: 'https://quizz-relampago.vercel.app/',
      tags: ['A/B', 'barras', 'wordcloud'],
      params: [
        { key: 'question', label: 'Pergunta', type: 'text', def: 'Qual escolhes?' },
        { key: 'a', label: 'Resposta A', type: 'text', def: 'Opção A' },
        { key: 'b', label: 'Resposta B', type: 'text', def: 'Opção B' },
        { key: 'keyA', label: 'Voto A (tecla)', type: 'text', def: 'A' },
        { key: 'keyB', label: 'Voto B (tecla)', type: 'text', def: 'B' },
      ],
      colorParams: [
        { key: 'aColor', label: 'Cor A', def: '#22c55e' },
        { key: 'bColor', label: 'Cor B', def: '#3b82f6' },
        { key: 'text', label: 'Texto', def: '#ffffff' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('question', vals.question);
        q.set('a', vals.a);
        q.set('b', vals.b);
        q.set('keyA', vals.keyA);
        q.set('keyB', vals.keyB);
        q.set('domain', domain);
        return q;
      },
      resetWords: (vals) => `${vals.keyA},${vals.keyB}`
    },

    {
      id: 'quizz4_4op',
      name: 'Quizz (4 opções) — beta',
      desc: 'Pergunta + 4 respostas. Esta versão usa "title" (não "question"). Lê A/B/C/D via wordcloud.',
      baseUrl: 'https://quizz4-beta.vercel.app/',
      tags: ['A/B/C/D', 'barras', 'wordcloud'],
      params: [
        { key: 'title', label: 'Pergunta', type: 'text', def: 'Qual escolhes?' },
        { key: 'a', label: 'Resposta A', type: 'text', def: 'Opção A' },
        { key: 'b', label: 'Resposta B', type: 'text', def: 'Opção B' },
        { key: 'c', label: 'Resposta C', type: 'text', def: 'Opção C' },
        { key: 'd', label: 'Resposta D', type: 'text', def: 'Opção D' },
      ],
      colorParams: [
        { key: 'accent', label: 'Accent', def: '#f59e0b' },
        { key: 'text', label: 'Texto', def: '#ffffff' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('title', vals.title);
        q.set('a', vals.a);
        q.set('b', vals.b);
        q.set('c', vals.c);
        q.set('d', vals.d);
        q.set('domain', domain);
        return q;
      },
      resetWords: () => `A,B,C,D`
    },

    // -------------------------
    // CHAT / ETC
    // -------------------------
    {
      id: 'question_and_comments',
      name: 'Pergunta + Comentários (mural vertical)',
      desc: 'Mostra pergunta e comentários em tempo real. Lê via wordcloud.',
      baseUrl: 'https://questionandcomments.vercel.app/',
      tags: ['chat', 'mural', 'wordcloud'],
      params: [
        { key: 'question', label: 'Pergunta', type: 'text', def: 'Escreve no chat…' },
      ],
      colorParams: [
        { key: 'gradient', label: 'Gradiente', def: '#0b0f1a' },
        { key: 'text', label: 'Texto', def: '#ffffff' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('question', vals.question);
        q.set('domain', domain);
        return q;
      }
    },

    {
      id: 'palavra_secreta',
      name: 'Palavra Secreta (forca leve)',
      desc: 'Traços + revela letras quando aparecem nos comentários. Lê via wordcloud.',
      baseUrl: 'https://palavra-secreta-sage.vercel.app/',
      tags: ['puzzle', 'wordcloud'],
      params: [
        { key: 'title', label: 'Título', type: 'text', def: 'Palavra Secreta' },
        { key: 'word', label: 'Palavra', type: 'text', def: 'LIDERANCA' },
        { key: 'tries', label: 'Tentativas', type: 'number', def: '8' },
      ],
      colorParams: [
        { key: 'accent', label: 'Accent', def: '#60a5fa' },
        { key: 'text', label: 'Texto', def: '#ffffff' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('title', vals.title);
        q.set('word', vals.word);
        q.set('tries', vals.tries);
        q.set('domain', domain);
        return q;
      }
    },

    {
      id: 'delay_game',
      name: 'Delay vs Orador (jogo do delay)',
      desc: 'Frases divertidas enquanto o chat chega (delay). Lê via wordcloud.',
      baseUrl: 'https://delay-omega.vercel.app/',
      tags: ['humor', 'delay', 'wordcloud'],
      params: [
        { key: 'title', label: 'Título', type: 'text', def: 'Delay vs Orador' },
        { key: 'seconds', label: 'Segundos de delay', type: 'number', def: '30' },
      ],
      colorParams: [
        { key: 'accent', label: 'Accent', def: '#f59e0b' },
        { key: 'text', label: 'Texto', def: '#ffffff' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('title', vals.title);
        q.set('seconds', vals.seconds);
        q.set('domain', domain);
        return q;
      }
    },

    {
      id: 'url_six',
      name: 'Website / URL (cartão animado)',
      desc: 'Overlay para divulgar um link (callout).',
      baseUrl: 'https://url-six-ruddy.vercel.app/',
      tags: ['URL', 'callout'],
      params: [
        { key: 'title', label: 'Título', type: 'text', def: 'Vai ao site' },
        { key: 'url', label: 'URL', type: 'text', def: 'https://teusite.com' },
      ],
      colorParams: [
        { key: 'accent', label: 'Accent', def: '#60a5fa' },
        { key: 'text', label: 'Texto', def: '#ffffff' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('title', vals.title);
        q.set('url', vals.url);
        q.set('domain', domain);
        return q;
      }
    },

    {
      id: 'medidor_energia',
      name: 'Medidor de Energia da Live',
      desc: 'Barra de energia que cresce com comentários. Lê via wordcloud.',
      baseUrl: 'https://medidor-energia.vercel.app/',
      tags: ['energia', 'barra', 'wordcloud'],
      params: [
        { key: 'title', label: 'Título', type: 'text', def: 'Energia da Live' },
        { key: 'max', label: 'Comentários para encher', type: 'number', def: '120' },
      ],
      colorParams: [
        { key: 'fill', label: 'Barra (fill)', def: '#f59e0b' },
        { key: 'track', label: 'Track', def: '#1b2335' },
        { key: 'text', label: 'Texto', def: '#ffffff' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('title', vals.title);
        q.set('max', vals.max);
        q.set('domain', domain);
        return q;
      }
    },

    // -------------------------
    // BALANÇA (CORRIGIDA)
    // -------------------------
    {
      id: 'balanca_wheat',
      name: 'Balança (A vs B)',
      desc: 'Balança de decisão. ESTE overlay lê: title / left / right (não question/optionA/optionB). Votos: "a" e "b".',
      baseUrl: 'https://balanca-wheat.vercel.app/',
      tags: ['A/B', 'balança', 'wordcloud'],
      params: [
        { key: 'title', label: 'Título', type: 'text', def: 'Balança de Decisão' },
        { key: 'left', label: 'Texto Esquerda', type: 'text', def: 'Opção A' },
        { key: 'right', label: 'Texto Direita', type: 'text', def: 'Opção B' },
      ],
      colorParams: [
        { key: 'aColor', label: 'Cor A', def: '#f59e0b' },
        { key: 'bColor', label: 'Cor B', def: '#60a5fa' },
        { key: 'text', label: 'Texto', def: '#ffffff' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('title', vals.title);
        q.set('left', vals.left);
        q.set('right', vals.right);
        q.set('domain', domain);
        return q;
      },
      resetWords: () => `a,b,A,B`
    },

    // -------------------------
    // LOWER THIRDS / BULLETS
    // -------------------------
    {
      id: 'nome_e_avatar',
      name: 'Lower Third (Nome + Avatar)',
      desc: 'Lower third com avatar via URL. Tema e cores por querystring.',
      baseUrl: 'https://nomeeavatar.vercel.app/',
      tags: ['lower third', 'nome', 'avatar'],
      params: [
        { key: 'name', label: 'Nome', type: 'text', def: 'Tiago Gonçalves' },
        { key: 'role', label: 'Cargo (opcional)', type: 'text', def: 'Host | Partícula Influente' },
        { key: 'avatar', label: 'Avatar (URL direta)', type: 'text', def: '' },
        { key: 'align', label: 'Alinhamento', type: 'select', def: 'left', options: ['left','center','right'] },
        { key: 'theme', label: 'Tema', type: 'select', def: 'blue', options: ['blue','orange','purple','mint'] },
        { key: 'duration', label: 'Auto-hide (segundos, 0=fixo)', type: 'number', def: '0' },
        { key: 'show', label: 'Mostrar (1/0)', type: 'select', def: '1', options: ['1','0'] },
      ],
      colorParams: [
        { key: 'accent', label: 'Accent', def: '#60a5fa' },
        { key: 'bg', label: 'Fundo', def: '#0b0f1a' },
        { key: 'text', label: 'Texto', def: '#ffffff' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('name', vals.name);
        if (vals.role) q.set('role', vals.role);
        if (vals.avatar) q.set('avatar', vals.avatar);
        q.set('align', vals.align);
        q.set('theme', vals.theme);
        q.set('duration', vals.duration);
        q.set('show', vals.show);
        q.set('domain', domain);
        return q;
      }
    },

    {
      id: 'nome_red',
      name: 'Lower Third (Nome) — versão Red',
      desc: 'Versão simples focada no nome. Fundo transparente.',
      baseUrl: 'https://nome-red.vercel.app/',
      tags: ['lower third', 'nome'],
      params: [
        { key: 'name', label: 'Nome', type: 'text', def: 'Tiago Gonçalves' },
        { key: 'role', label: 'Cargo (opcional)', type: 'text', def: '' },
        { key: 'align', label: 'Alinhamento', type: 'select', def: 'left', options: ['left','center','right'] },
        { key: 'duration', label: 'Auto-hide (segundos, 0=fixo)', type: 'number', def: '0' },
        { key: 'show', label: 'Mostrar (1/0)', type: 'select', def: '1', options: ['1','0'] },
      ],
      colorParams: [
        { key: 'accent', label: 'Accent', def: '#ef4444' },
        { key: 'text', label: 'Texto', def: '#ffffff' },
        { key: 'bg', label: 'Fundo', def: '#0b0f1a' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('name', vals.name);
        if (vals.role) q.set('role', vals.role);
        q.set('align', vals.align);
        q.set('duration', vals.duration);
        q.set('show', vals.show);
        q.set('domain', domain);
        return q;
      }
    },

    {
      id: 'bullets_dock_10',
      name: 'Bullet Points (Dock) — até 10 pontos',
      desc: 'Lista em modo dock. Aceita item1…item10. Sem agenda/footer.',
      baseUrl: 'https://bulletpoints.vercel.app/',
      tags: ['bullets', 'dock', 'OBS'],
      params: [
        { key: 'item1', label: 'Ponto 1', type: 'text', def: 'Introdução' },
        { key: 'item2', label: 'Ponto 2', type: 'text', def: 'Manifesto' },
        { key: 'item3', label: 'Ponto 3', type: 'text', def: 'Os Líderes' },
        { key: 'item4', label: 'Ponto 4', type: 'text', def: 'Matrioska' },
        { key: 'item5', label: 'Ponto 5', type: 'text', def: 'O caminho' },
        { key: 'item6', label: 'Ponto 6', type: 'text', def: '' },
        { key: 'item7', label: 'Ponto 7', type: 'text', def: '' },
        { key: 'item8', label: 'Ponto 8', type: 'text', def: '' },
        { key: 'item9', label: 'Ponto 9', type: 'text', def: '' },
        { key: 'item10', label: 'Ponto 10', type: 'text', def: '' },
        { key: 'dock', label: 'Dock (tr/tl/br/bl)', type: 'select', def: 'tr', options: ['tr','tl','br','bl'] },
        { key: 'speed', label: 'Velocidade (0.4-2)', type: 'number', def: '1' },
      ],
      colorParams: [
        { key: 'accent', label: 'Accent', def: '#f59e0b' },
        { key: 'text', label: 'Texto', def: '#ffffff' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        for (let i = 1; i <= 10; i++) {
          const v = vals['item' + i];
          if (v) q.set('item' + i, v);
        }
        if (vals.dock) q.set('dock', vals.dock);
        if (vals.speed) q.set('speed', vals.speed);
        q.set('domain', domain);
        return q;
      }
    },

    {
      id: 'single_point_active',
      name: 'Single Bullet (ponto único)',
      desc: 'Mostra apenas 1 ponto em destaque.',
      baseUrl: 'https://singlepoint.vercel.app/',
      tags: ['single', 'bullet', 'OBS'],
      params: [
        { key: 'text', label: 'Texto do ponto', type: 'text', def: 'Introdução' },
        { key: 'dock', label: 'Dock (tr/tl/br/bl)', type: 'select', def: 'tr', options: ['tr','tl','br','bl'] },
        { key: 'speed', label: 'Velocidade (0.4-2)', type: 'number', def: '1' }
      ],
      colorParams: [
        { key: 'accent', label: 'Accent', def: '#f59e0b' },
        { key: 'textColor', label: 'Texto', def: '#ffffff' },
        { key: 'bg', label: 'Fundo', def: '#0b0f1a' }
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('text', vals.text);
        if (vals.dock) q.set('dock', vals.dock);
        if (vals.speed) q.set('speed', vals.speed);
        q.set('domain', domain);
        return q;
      }
    },
  ];

  // ----------------------
  // Smoke tests
  // ----------------------
  (function runSmokeTests(){
    try {
      console.assert(Array.isArray(ANIMS), 'ANIMS deve ser um array');
      console.assert(ANIMS.length > 0, 'ANIMS não pode estar vazio');
      console.assert(ANIMS.every(x => x && typeof x === 'object'), 'ANIMS contém entradas inválidas');
      console.assert(ANIMS.every(x => typeof x.build === 'function'), 'Há overlays sem função build()');
      console.assert(ANIMS.every(x => typeof x.baseUrl === 'string' && x.baseUrl.length), 'Há overlays sem baseUrl');
    } catch(e){
      console.warn('Smoke tests falharam:', e);
    }
  })();

  const $list = document.getElementById('list');
  const $domain = document.getElementById('domain');
  const $toast = document.getElementById('toast');

  function el(tag, attrs = {}, children = []){
    const node = document.createElement(tag);
    for (const [k, v] of Object.entries(attrs)){
      if (k === 'class') node.className = v;
      else if (k === 'html') node.innerHTML = v;
      else if (k === 'text') node.textContent = v;
      else node.setAttribute(k, v);
    }
    for (const c of children) node.appendChild(c);
    return node;
  }

  function toast(msg){
    $toast.textContent = msg;
    $toast.classList.add('show');
    setTimeout(()=> $toast.classList.remove('show'), 900);
  }

  function normalizeBaseUrl(u){
    return String(u || '').trim().replace(/\?[^]*$/,'').replace(/\/$/,'');
  }

  function buildUrl(baseUrl, query){
    const base = normalizeBaseUrl(baseUrl);
    const qs = query.toString();
    return qs ? `${base}/?${qs}` : `${base}/`;
  }

  async function clearChat(domain, words){
    const base = String(domain || '').trim().replace(/\/$/, '');
    if (!base) throw new Error('Domain vazio');

    const url = (words && String(words).trim())
      ? `${base}/clear-chat?words=${encodeURIComponent(words)}`
      : `${base}/clear-chat`;

    try {
      await fetch(url, { mode: 'no-cors' });
      return { ok: true, via: 'fetch', url };
    } catch {
      window.open(url, '_blank', 'noopener,noreferrer');
      return { ok: true, via: 'open', url };
    }
  }

  function hexOrEmpty(v){
    const s = String(v || '').trim();
    if (!s) return '';
    if (/^#[0-9a-fA-F]{6}$/.test(s)) return s;
    return '';
  }

  function buildCard(anim){
    const meta = el('div', { class: 'meta' }, [
      el('h2', { text: anim.name }),
      el('div', { class: 'desc', text: anim.desc }),
      el('div', { class: 'tags' }, (anim.tags || []).map(t => el('span', { class: 'tag', text: t })))
    ]);

    const tools = el('div', { class: 'tools' });

    const selSize = el('select', {}, [
      el('option', { value: '16x6', text: '16×6 (overlay)' }),
      el('option', { value: '16x9', text: '16×9' }),
    ]);

    const sizepill = el('span', { class: 'sizepill' }, [
      el('span', { text: 'Preview' }),
      selSize
    ]);

    const btnCopy = el('button', { class: 'good small', text: 'Copiar link' });
    const btnOpen = el('button', { class: 'primary small', text: 'Abrir' });
    const btnReset = el('button', { class: 'ghost small', text: 'Reset' });
    const btnResetWordcloud = el('button', { class: 'warn small', text: 'Reset wordcloud' });

    tools.appendChild(sizepill);
    tools.appendChild(btnCopy);
    tools.appendChild(btnOpen);
    tools.appendChild(btnReset);
    tools.appendChild(btnResetWordcloud);

    const top = el('div', { class: 'toprow' }, [ meta, tools ]);

    const form = el('div', { class: 'form' });
    const inputs = {};
    const colorInputs = {};

    const baseField = el('div', { class: 'field' }, [
      el('label', { text: 'Base URL (podes trocar para o teu domínio)' }),
    ]);
    const baseInput = el('input', { type: 'text', value: anim.baseUrl });
    inputs.__baseUrl = baseInput;
    baseField.appendChild(baseInput);
    form.appendChild(baseField);

    (anim.params || []).forEach(p => {
      const field = el('div', { class: 'field' }, [ el('label', { text: p.label }) ]);

      let control;
      if (p.type === 'select'){
        control = el('select');
        (p.options || []).forEach(opt => control.appendChild(el('option', { value: opt, text: opt })));
        control.value = p.def ?? (p.options?.[0] ?? '');
      } else {
        control = el('input', { type: p.type || 'text', value: (p.def ?? '') });
      }

      inputs[p.key] = control;
      field.appendChild(control);
      form.appendChild(field);
    });

    let colorsBlock = null;
    if (Array.isArray(anim.colorParams) && anim.colorParams.length){
      colorsBlock = el('div', {}, [
        el('div', { class: 'sectionTitle', text: 'Cores (querystring)' })
      ]);

      const grid = el('div', { class: 'colorGrid' });

      anim.colorParams.forEach(c => {
        const field = el('div', { class: 'field' });
        const lbl = el('label', { text: c.label });

        const row = el('div', { class: 'colorRow' });
        const sw = el('div', { class: 'swatch' });

        const picker = el('input', { type: 'color', value: c.def || '#ffffff' });
        const hex = el('input', { type: 'text', value: c.def || '#ffffff', placeholder: '#RRGGBB' });

        function syncFromPicker(){
          hex.value = picker.value;
          sw.style.background = picker.value;
        }
        function syncFromHex(){
          const v = hexOrEmpty(hex.value);
          if (v){
            picker.value = v;
            sw.style.background = v;
          }
        }

        picker.addEventListener('input', () => { syncFromPicker(); compute(); });
        hex.addEventListener('input', () => { syncFromHex(); compute(); });

        sw.style.background = picker.value;

        colorInputs[c.key] = { picker, hex, sw };

        row.appendChild(sw);
        row.appendChild(picker);
        row.appendChild(hex);

        field.appendChild(lbl);
        field.appendChild(row);
        grid.appendChild(field);
      });

      colorsBlock.appendChild(grid);
    }

    const out = el('div', { class: 'out' }, [
      el('div', { class: 'label', text: 'Link final (Browser Source do OBS)' }),
      el('div', { class: 'url', text: '' })
    ]);
    const outUrl = out.querySelector('.url');

    const preview = el('div', { class: 'preview' });
    const pbar = el('div', { class: 'bar' }, [
      el('div', { class: 'left', html: '<span>Preview</span><span style="opacity:.65">(ajusta a escala no OBS se precisares)</span>' }),
      el('div', { class: 'right', html: '<span style="opacity:.65">Fundo transparente (se a overlay suportar)</span>' })
    ]);

    const stageWrap = el('div', { class: 'stageWrap' });
    const iframe = el('iframe', { class: 'stage', allow: 'autoplay' });
    stageWrap.appendChild(iframe);
    preview.appendChild(pbar);
    preview.appendChild(stageWrap);

    function getVals(){
      const vals = {};
      (anim.params || []).forEach(p => vals[p.key] = (inputs[p.key]?.value ?? ''));
      return vals;
    }

    function getColors(){
      const colors = {};
      if (!anim.colorParams) return colors;
      anim.colorParams.forEach(c => {
        const h = colorInputs[c.key]?.hex?.value;
        const v = hexOrEmpty(h);
        if (v) colors[c.key] = v;
      });
      return colors;
    }

    function compute(){
      const domain = ($domain.value || '').trim() || 'http://localhost:3900';
      const base = (inputs.__baseUrl.value || anim.baseUrl).trim();
      const vals = getVals();
      const colors = getColors();

      const query = anim.build(vals, domain);
      Object.entries(colors).forEach(([k,v]) => query.set(k, v));

      const url = buildUrl(base, query);

      outUrl.textContent = url;
      iframe.src = url;

      return { url, domain, vals };
    }

    Object.values(inputs).forEach(i => i.addEventListener('input', compute));
    $domain.addEventListener('input', compute);

    selSize.addEventListener('change', () => {
      stageWrap.classList.toggle('r169', selSize.value === '16x9');
    });

    btnCopy.addEventListener('click', async () => {
      const { url } = compute();
      try {
        await navigator.clipboard.writeText(url);
        toast('Copiado ✅');
      } catch {
        const ta = document.createElement('textarea');
        ta.value = url;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        ta.remove();
        toast('Copiado ✅');
      }
    });

    btnOpen.addEventListener('click', () => {
      const { url } = compute();
      window.open(url, '_blank', 'noopener');
    });

    btnReset.addEventListener('click', () => {
      inputs.__baseUrl.value = anim.baseUrl;
      (anim.params || []).forEach(p => {
        const c = inputs[p.key];
        if (!c) return;
        if (p.type === 'select') c.value = p.def ?? (p.options?.[0] ?? '');
        else c.value = (p.def ?? '');
      });

      (anim.colorParams || []).forEach(c => {
        const def = c.def || '#ffffff';
        if (colorInputs[c.key]){
          colorInputs[c.key].picker.value = def;
          colorInputs[c.key].hex.value = def;
          colorInputs[c.key].sw.style.background = def;
        }
      });

      compute();
      toast('Reset feito');
    });

    btnResetWordcloud.addEventListener('click', async () => {
      const { domain, vals } = compute();
      const words = (typeof anim.resetWords === 'function') ? (anim.resetWords(vals) || '') : '';
      const res = await clearChat(domain, words);
      toast(res.via === 'fetch' ? 'Reset feito ✅' : 'Reset aberto (tab) ✅');
    });

    const hint = el('div', { class: 'hint', html: 'Nota: se a overlay não suportar certos params, ela ignora. Para overlays novas, confirma os nomes exactos dos params.' });

    const children = [ top, form ];
    if (colorsBlock) children.push(colorsBlock);
    children.push(preview, out, hint);

    const card = el('div', { class: 'card' }, children);

    setTimeout(compute, 0);
    return card;
  }

  ANIMS.forEach(a => $list.appendChild(buildCard(a)));
</script>

</body>
</html>
