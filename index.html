<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Testes de Overlays (OBS)</title>
  <style>
    :root{
      --bg:#0b0f1a;
      --card: rgba(255,255,255,0.06);
      --stroke: rgba(255,255,255,0.12);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.68);
      --accent:#60a5fa;
      --good:#22c55e;
      --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 600px at 20% 10%, rgba(96,165,250,0.25), transparent),
                  radial-gradient(900px 500px at 90% 30%, rgba(245,158,11,0.18), transparent),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 28px;
    }

    header{
      max-width: 1320px;
      margin: 0 auto 18px;
      display:flex;
      gap: 16px;
      align-items: flex-end;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    h1{ margin:0; font-size: 28px; letter-spacing: 0.2px; }
    .sub{ margin-top:6px; color: var(--muted); font-size: 14px; max-width: 880px; line-height:1.35; }

    .pill{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,0.22);
      padding: 10px 12px;
      border-radius: 999px;
      display:flex;
      gap:10px;
      align-items:center;
      max-width: 100%;
    }
    .pill label{ font-size: 12px; color: var(--muted); }
    .pill input{
      width: 420px;
      max-width: 60vw;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text);
      font-size: 13px;
    }

    /* GRID 2 COLUNAS */
    .wrap{
      max-width: 1320px;
      margin: 0 auto;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 1100px){
      .wrap{ grid-template-columns: 1fr; }
    }

    .card{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(0,0,0,0.12));
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 22px 70px rgba(0,0,0,0.35);
      display:flex;
      flex-direction:column;
      gap: 12px;
      overflow:hidden;
    }

    .toprow{
      display:flex;
      gap: 12px;
      align-items:flex-start;
      justify-content: space-between;
    }

    .meta h2{ margin: 0 0 6px; font-size: 18px; }
    .meta .desc{ margin: 0 0 10px; font-size: 13px; color: var(--muted); line-height: 1.35; }

    .tags{ display:flex; gap: 8px; flex-wrap: wrap; }
    .tag{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,0.18);
      color: var(--muted);
    }

    .tools{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      justify-content:flex-end;
    }

    .sizepill{
      display:flex;
      gap:8px;
      align-items:center;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,0.18);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
    }
    .sizepill select{
      border:none;
      outline:none;
      background: transparent;
      color: var(--text);
      font-size: 12px;
    }

    button{
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,0.22);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 800;
      letter-spacing: 0.2px;
    }
    button.small{ padding: 9px 11px; border-radius: 12px; font-size: 12px; }
    button.primary{ border-color: rgba(96,165,250,0.45); background: rgba(96,165,250,0.16); }
    button.good{ border-color: rgba(34,197,94,0.45); background: rgba(34,197,94,0.14); }
    button.warn{ border-color: rgba(245,158,11,0.55); background: rgba(245,158,11,0.14); }
    button.ghost{ background: rgba(0,0,0,0.16); }

    .form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 560px){
      .form{ grid-template-columns: 1fr; }
    }

    .field{
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,0.18);
      border-radius: 14px;
      padding: 10px 12px;
      min-width:0;
    }
    .field label{ display:block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    .field input, .field select{
      width:100%;
      border:none;
      outline:none;
      background: transparent;
      color: var(--text);
      font-size: 14px;
    }

    .out{
      border: 1px dashed rgba(255,255,255,0.20);
      background: rgba(0,0,0,0.18);
      border-radius: 14px;
      padding: 12px;
    }
    .out .label{ font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    .out .url{ font-size: 13px; word-break: break-all; line-height: 1.35; }

    /* PREVIEW dentro do card */
    .preview{
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.22);
      border-radius: 16px;
      overflow:hidden;
      box-shadow: 0 18px 60px rgba(0,0,0,0.28);
    }
    .preview .bar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      color: var(--muted);
      font-size: 12px;
      gap: 10px;
    }
    .preview .bar .left{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .preview .bar .right{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }

    .stageWrap{
      width: 100%;
      aspect-ratio: 16/6; /* 1920x720-ish (bom para overlays) */
      background: #000;
      position: relative;
    }
    .stageWrap.r169{ aspect-ratio: 16/9; }

    .stage{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      border:0;
      background: transparent;
    }

    .hint{ font-size: 12px; color: var(--muted); line-height: 1.35; }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.65);
      border: 1px solid rgba(255,255,255,0.18);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      opacity: 0;
      pointer-events:none;
      transition: opacity 220ms ease;
      font-size: 13px;
      z-index: 50;
    }
    .toast.show{ opacity: 1; }
  </style>
</head>
<body>

<header>
  <div>
    <h1>Página de Testes de Overlays (OBS)</h1>
    <div class="sub">Escolhe uma animação, preenche os campos e copia o link final. Podes ver o preview dentro do card ou abrir em separador.</div>
  </div>

  <div class="pill">
    <label for="domain">Domain</label>
    <input id="domain" type="text" value="http://localhost:3900" />
  </div>
</header>

<div class="wrap" id="list"></div>

<div class="toast" id="toast">Copiado ✅</div>

<script>
  // =========================
  // Página de Testes (OBS)
  // - Gera links com querystring
  // - Preview responsivo dentro do card
  // - Botão reset wordcloud via /clear-chat
  // =========================

  const ANIMS = [
    {
      id: 'votacao_ao_vivo_sim_nao',
      name: 'Votação ao Vivo (Sim / Não) — amCharts',
      desc: 'Gráfico circular (amCharts) para Sim/Não. Lê via wordcloud. Usa parâmetros yes/no e domain.',
      baseUrl: 'https://votacao-ao-vivo.vercel.app/',
      tags: ['Sim/Não', 'amCharts', 'wordcloud'],
      params: [
        { key: 'yes', label: 'Texto Sim', type: 'text', def: 'Sim' },
        { key: 'no', label: 'Texto Não', type: 'text', def: 'Não' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('yes', vals.yes);
        q.set('no', vals.no);
        q.set('domain', domain);
        return q;
      },
      resetWords: (vals) => `${vals.yes},${vals.no}`
    },

    {
      id: 'votacoes_poll4_abcd',
      name: 'Votações (A/B/C/D) — contadores + barras',
      desc: 'Poll 4 opções. Pergunta + opções no URL. Lê via wordcloud (A,B,C,D).',
      baseUrl: 'https://votacoes.vercel.app/',
      tags: ['A/B/C/D', 'barras', 'wordcloud'],
      params: [
        { key: 'title', label: 'Título', type: 'text', def: 'Qual escolhes?' },
        { key: 'a', label: 'Opção A', type: 'text', def: 'Opção A' },
        { key: 'b', label: 'Opção B', type: 'text', def: 'Opção B' },
        { key: 'c', label: 'Opção C', type: 'text', def: 'Opção C' },
        { key: 'd', label: 'Opção D', type: 'text', def: 'Opção D' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('title', vals.title);
        q.set('a', vals.a);
        q.set('b', vals.b);
        q.set('c', vals.c);
        q.set('d', vals.d);
        q.set('domain', domain);
        return q;
      },
      resetWords: () => `A,B,C,D`
    },

    {
      id: 'quizz_relampago_2op',
      name: 'Quizz Relâmpago (2 opções)',
      desc: 'Pergunta + 2 respostas com contagem e barras. Aceita votos A/B. Lê via wordcloud.',
      baseUrl: 'https://quizz-relampago.vercel.app/',
      tags: ['A/B', 'barras', 'wordcloud'],
      params: [
        { key: 'question', label: 'Pergunta', type: 'text', def: 'Qual escolhes?' },
        { key: 'a', label: 'Resposta A', type: 'text', def: 'Opção A' },
        { key: 'b', label: 'Resposta B', type: 'text', def: 'Opção B' },
        { key: 'keyA', label: 'Voto A (tecla)', type: 'text', def: 'A' },
        { key: 'keyB', label: 'Voto B (tecla)', type: 'text', def: 'B' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('question', vals.question);
        q.set('a', vals.a);
        q.set('b', vals.b);
        q.set('keyA', vals.keyA);
        q.set('keyB', vals.keyB);
        q.set('domain', domain);
        return q;
      },
      resetWords: (vals) => `${vals.keyA},${vals.keyB}`
    },

    {
      id: 'quizz4_4op',
      name: 'Quizz (4 opções)',
      desc: 'Pergunta + 4 respostas com contagem. Aceita votos A/B/C/D. Lê via wordcloud.',
      baseUrl: 'https://quizz4-beta.vercel.app/',
      tags: ['A/B/C/D', 'barras', 'wordcloud'],
      params: [
        { key: 'question', label: 'Pergunta', type: 'text', def: 'Qual escolhes?' },
        { key: 'a', label: 'Resposta A', type: 'text', def: 'Opção A' },
        { key: 'b', label: 'Resposta B', type: 'text', def: 'Opção B' },
        { key: 'c', label: 'Resposta C', type: 'text', def: 'Opção C' },
        { key: 'd', label: 'Resposta D', type: 'text', def: 'Opção D' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('question', vals.question);
        q.set('a', vals.a);
        q.set('b', vals.b);
        q.set('c', vals.c);
        q.set('d', vals.d);
        q.set('domain', domain);
        return q;
      },
      resetWords: () => `A,B,C,D`
    },

    {
      id: 'question_and_comments',
      name: 'Pergunta + Comentários (mural vertical)',
      desc: 'Mostra pergunta e comentários em tempo real. Lê via wordcloud.',
      baseUrl: 'https://questionandcomments.vercel.app/',
      tags: ['chat', 'mural', 'wordcloud'],
      params: [
        { key: 'question', label: 'Pergunta', type: 'text', def: 'Escreve no chat…' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('question', vals.question);
        q.set('domain', domain);
        return q;
      }
    },

    {
      id: 'palavra_secreta',
      name: 'Palavra Secreta (forca leve)',
      desc: 'Traços + revela letras quando aparecem nos comentários. Lê via wordcloud.',
      baseUrl: 'https://palavra-secreta-sage.vercel.app/',
      tags: ['puzzle', 'wordcloud'],
      params: [
        { key: 'title', label: 'Título', type: 'text', def: 'Palavra Secreta' },
        { key: 'word', label: 'Palavra', type: 'text', def: 'LIDERANCA' },
        { key: 'tries', label: 'Tentativas', type: 'number', def: '8' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('title', vals.title);
        q.set('word', vals.word);
        q.set('tries', vals.tries);
        q.set('domain', domain);
        return q;
      }
    },

    {
      id: 'delay_game',
      name: 'Delay vs Orador (jogo do delay)',
      desc: 'Frases divertidas enquanto o chat chega (delay). Lê via wordcloud.',
      baseUrl: 'https://delay-omega.vercel.app/',
      tags: ['humor', 'delay', 'wordcloud'],
      params: [
        { key: 'title', label: 'Título', type: 'text', def: 'Delay vs Orador' },
        { key: 'seconds', label: 'Segundos de delay', type: 'number', def: '30' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('title', vals.title);
        q.set('seconds', vals.seconds);
        q.set('domain', domain);
        return q;
      }
    },

    {
      id: 'url_six',
      name: 'Website / URL (cartão animado)',
      desc: 'Overlay para divulgar um link (callout).',
      baseUrl: 'https://url-six-ruddy.vercel.app/',
      tags: ['URL', 'callout'],
      params: [
        { key: 'title', label: 'Título', type: 'text', def: 'Vai ao site' },
        { key: 'url', label: 'URL', type: 'text', def: 'https://teusite.com' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('title', vals.title);
        q.set('url', vals.url);
        q.set('domain', domain);
        return q;
      }
    },

    {
      id: 'medidor_energia',
      name: 'Medidor de Energia da Live',
      desc: 'Barra de energia que cresce com comentários. Lê via wordcloud.',
      baseUrl: 'https://medidor-energia.vercel.app/',
      tags: ['energia', 'barra', 'wordcloud'],
      params: [
        { key: 'title', label: 'Título', type: 'text', def: 'Energia da Live' },
        { key: 'max', label: 'Comentários para encher', type: 'number', def: '120' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('title', vals.title);
        q.set('max', vals.max);
        q.set('domain', domain);
        return q;
      }
    },

    {
      id: 'balanca_wheat',
      name: 'Balança (A vs B)',
      desc: 'Balança de decisão A/B. Lê via wordcloud.',
      baseUrl: 'https://balanca-wheat.vercel.app/',
      tags: ['A/B', 'balança', 'wordcloud'],
      params: [
        { key: 'question', label: 'Pergunta', type: 'text', def: 'Balança de Decisão' },
        { key: 'optionA', label: 'Opção A', type: 'text', def: 'Opção A' },
        { key: 'optionB', label: 'Opção B', type: 'text', def: 'Opção B' },
        { key: 'align', label: 'Alinhamento', type: 'text', def: 'bottom' },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('question', vals.question);
        q.set('optionA', vals.optionA);
        q.set('optionB', vals.optionB);
        q.set('align', vals.align);
        q.set('domain', domain);
        return q;
      },
      resetWords: () => `A,B`
    },

    // ====== NOVAS (NOME / AVATAR) ======
    {
      id: 'nome_e_avatar',
      name: 'Lower Third (Nome + Avatar)',
      desc: 'Lower third com avatar via URL (link direto) e tema (blue/orange/purple/mint). Fundo transparente.',
      // Nota: o link do Vercel que enviaste é do dashboard. Aqui fica o domínio provável.
      // Se não bater certo, troca no campo “Base URL” para o teu domínio real.
      baseUrl: 'https://nomeeavatar.vercel.app/',
      tags: ['lower third', 'nome', 'avatar', 'OBS'],
      params: [
        { key: 'name', label: 'Nome', type: 'text', def: 'Tiago Gonçalves' },
        { key: 'role', label: 'Cargo (opcional)', type: 'text', def: 'Host | Partícula Influente' },
        { key: 'avatar', label: 'Avatar (URL direta)', type: 'text', def: '' },
        { key: 'align', label: 'Alinhamento', type: 'select', def: 'left', options: ['left','center','right'] },
        { key: 'theme', label: 'Tema/Cor', type: 'select', def: 'blue', options: ['blue','orange','purple','mint'] },
        { key: 'duration', label: 'Auto-hide (segundos, 0=fixo)', type: 'number', def: '0' },
        { key: 'show', label: 'Mostrar (1/0)', type: 'select', def: '1', options: ['1','0'] },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('name', vals.name);
        if (vals.role) q.set('role', vals.role);
        if (vals.avatar) q.set('avatar', vals.avatar);
        q.set('align', vals.align);
        q.set('theme', vals.theme);
        q.set('duration', vals.duration);
        q.set('show', vals.show);
        // domain por consistência (mesmo que a overlay não use)
        q.set('domain', domain);
        return q;
      }
    },

    {
      id: 'nome_red',
      name: 'Lower Third (Nome) — versão Red',
      desc: 'Versão simples focada no nome (estilo callout). Fundo transparente.',
      baseUrl: 'https://nome-red.vercel.app/',
      tags: ['lower third', 'nome', 'OBS'],
      params: [
        { key: 'name', label: 'Nome', type: 'text', def: 'Tiago Gonçalves' },
        { key: 'role', label: 'Cargo (opcional)', type: 'text', def: '' },
        { key: 'align', label: 'Alinhamento', type: 'select', def: 'left', options: ['left','center','right'] },
        { key: 'duration', label: 'Auto-hide (segundos, 0=fixo)', type: 'number', def: '0' },
        { key: 'show', label: 'Mostrar (1/0)', type: 'select', def: '1', options: ['1','0'] },
      ],
      build: (vals, domain) => {
        const q = new URLSearchParams();
        q.set('name', vals.name);
        if (vals.role) q.set('role', vals.role);
        q.set('align', vals.align);
        q.set('duration', vals.duration);
        q.set('show', vals.show);
        q.set('domain', domain);
        return q;
      }
    }
  ];

  // ---------- DOM ----------
  const $list = document.getElementById('list');
  const $domain = document.getElementById('domain');
  const $toast = document.getElementById('toast');

  // ---------- Helpers ----------
  function el(tag, attrs = {}, children = []){
    const node = document.createElement(tag);
    for (const [k, v] of Object.entries(attrs)){
      if (k === 'class') node.className = v;
      else if (k === 'html') node.innerHTML = v;
      else if (k === 'text') node.textContent = v;
      else node.setAttribute(k, v);
    }
    for (const c of children) node.appendChild(c);
    return node;
  }

  function toast(msg){
    $toast.textContent = msg;
    $toast.classList.add('show');
    setTimeout(()=> $toast.classList.remove('show'), 900);
  }

  function normalizeBaseUrl(u){
    return String(u || '').trim().replace(/\?[^]*$/,'').replace(/\/$/,'');
  }

  function buildUrl(baseUrl, query){
    const base = normalizeBaseUrl(baseUrl);
    const qs = query.toString();
    return qs ? `${base}/?${qs}` : `${base}/`;
  }

  async function clearChat(domain, words){
    const base = String(domain || '').trim().replace(/\/$/, '');
    if (!base) throw new Error('Domain vazio');

    const url = (words && String(words).trim())
      ? `${base}/clear-chat?words=${encodeURIComponent(words)}`
      : `${base}/clear-chat`;

    try {
      await fetch(url, { mode: 'no-cors' });
      return { ok: true, via: 'fetch', url };
    } catch {
      window.open(url, '_blank', 'noopener,noreferrer');
      return { ok: true, via: 'open', url };
    }
  }

  function buildCard(anim){
    const meta = el('div', { class: 'meta' }, [
      el('h2', { text: anim.name }),
      el('div', { class: 'desc', text: anim.desc }),
      el('div', { class: 'tags' }, (anim.tags || []).map(t => el('span', { class: 'tag', text: t })))
    ]);

    const tools = el('div', { class: 'tools' });

    const selSize = el('select', {}, [
      el('option', { value: '16x6', text: '16×6 (overlay)' }),
      el('option', { value: '16x9', text: '16×9' }),
    ]);

    const sizepill = el('span', { class: 'sizepill' }, [
      el('span', { text: 'Preview' }),
      selSize
    ]);

    const btnCopy = el('button', { class: 'good small', text: 'Copiar link' });
    const btnOpen = el('button', { class: 'primary small', text: 'Abrir' });
    const btnReset = el('button', { class: 'ghost small', text: 'Reset' });
    const btnResetWordcloud = el('button', { class: 'warn small', text: 'Reset wordcloud' });

    tools.appendChild(sizepill);
    tools.appendChild(btnCopy);
    tools.appendChild(btnOpen);
    tools.appendChild(btnReset);
    tools.appendChild(btnResetWordcloud);

    const top = el('div', { class: 'toprow' }, [ meta, tools ]);

    const form = el('div', { class: 'form' });
    const inputs = {};

    // Base URL editável
    const baseField = el('div', { class: 'field' }, [
      el('label', { text: 'Base URL (podes trocar para o teu domínio)' }),
    ]);
    const baseInput = el('input', { type: 'text', value: anim.baseUrl });
    inputs.__baseUrl = baseInput;
    baseField.appendChild(baseInput);
    form.appendChild(baseField);

    // Campos
    (anim.params || []).forEach(p => {
      const field = el('div', { class: 'field' }, [ el('label', { text: p.label }) ]);

      let control;
      if (p.type === 'select'){
        control = el('select');
        (p.options || []).forEach(opt => {
          const o = el('option', { value: opt, text: opt });
          control.appendChild(o);
        });
        control.value = p.def ?? (p.options?.[0] ?? '');
      } else {
        control = el('input', {
          type: p.type || 'text',
          value: (p.def ?? ''),
        });
      }

      inputs[p.key] = control;
      field.appendChild(control);
      form.appendChild(field);
    });

    const out = el('div', { class: 'out' }, [
      el('div', { class: 'label', text: 'Link final (Browser Source do OBS)' }),
      el('div', { class: 'url', text: '' })
    ]);
    const outUrl = out.querySelector('.url');

    const preview = el('div', { class: 'preview' });
    const pbar = el('div', { class: 'bar' }, [
      el('div', { class: 'left', html: '<span>Preview</span><span style="opacity:.65">(ajusta a escala no OBS se precisares)</span>' }),
      el('div', { class: 'right', html: '<span style="opacity:.65">Fundo transparente</span>' })
    ]);

    const stageWrap = el('div', { class: 'stageWrap' });
    const iframe = el('iframe', { class: 'stage', allow: 'autoplay' });
    stageWrap.appendChild(iframe);
    preview.appendChild(pbar);
    preview.appendChild(stageWrap);

    function getVals(){
      const vals = {};
      (anim.params || []).forEach(p => {
        vals[p.key] = (inputs[p.key]?.value ?? '');
      });
      return vals;
    }

    function compute(){
      const domain = ($domain.value || '').trim() || 'http://localhost:3900';
      const base = (inputs.__baseUrl.value || anim.baseUrl).trim();
      const vals = getVals();
      const query = anim.build(vals, domain);
      const url = buildUrl(base, query);

      outUrl.textContent = url;
      iframe.src = url;

      return { url, domain, vals };
    }

    // eventos
    Object.values(inputs).forEach(i => i.addEventListener('input', compute));
    $domain.addEventListener('input', compute);

    selSize.addEventListener('change', () => {
      const v = selSize.value;
      stageWrap.classList.toggle('r169', v === '16x9');
    });

    btnCopy.addEventListener('click', async () => {
      const { url } = compute();
      try {
        await navigator.clipboard.writeText(url);
        toast('Copiado ✅');
      } catch {
        const ta = document.createElement('textarea');
        ta.value = url;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        ta.remove();
        toast('Copiado ✅');
      }
    });

    btnOpen.addEventListener('click', () => {
      const { url } = compute();
      window.open(url, '_blank', 'noopener');
    });

    btnReset.addEventListener('click', () => {
      inputs.__baseUrl.value = anim.baseUrl;
      (anim.params || []).forEach(p => {
        const c = inputs[p.key];
        if (!c) return;
        if (p.type === 'select') c.value = p.def ?? (p.options?.[0] ?? '');
        else c.value = (p.def ?? '');
      });
      compute();
      toast('Reset feito');
    });

    btnResetWordcloud.addEventListener('click', async () => {
      const { domain, vals } = compute();
      const words = (typeof anim.resetWords === 'function') ? (anim.resetWords(vals) || '') : '';
      const res = await clearChat(domain, words);
      toast(res.via === 'fetch' ? 'Reset feito ✅' : 'Reset aberto (tab) ✅');
    });

    const hint = el('div', { class: 'hint', html: 'Dica: no OBS, se estiveres a testar repetidamente, ativa “Refresh cache of current page”. Se a tua página estiver em <b>https</b> e o domain em <b>http</b>, alguns fetch podem ser bloqueados (mixed content).'});

    const card = el('div', { class: 'card' }, [ top, form, preview, out, hint ]);

    setTimeout(compute, 0);
    return card;
  }

  // Render
  ANIMS.forEach(a => $list.appendChild(buildCard(a)));
</script>

</body>
</html>
